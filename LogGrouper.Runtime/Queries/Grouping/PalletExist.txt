--SELECT AD.DROPID AS DROPID, 
--AD.BULTOS AS BULTOS,
--AD.USUARIO AS USUARIO, 
--AD.NUMEROPEDIDO AS NUMEROPEDIDO, 
--D.ISCLOSED,
--O.STATUS,
--O.ORDERGROUP,
--O.HOSTPROCESSREQUIRED AS ISCANCELLED
--FROM {Scheme}.AGRUPADO_DETALLE AD
--INNER JOIN {Scheme}.DROPID D ON AD.DROPID = D.DROPID
--INNER JOIN {Scheme}.ORDERS O ON AD.NUMEROPEDIDO = O.REFERENCEDOCUMENT
--WHERE NUMEROPEDIDO = '{Order_Id}'

SELECT AD.DROPID AS DROPID, 
       AD.BULTOS AS BULTOS,
       AD.USUARIO AS USUARIO, 
       --AD.NUMEROPEDIDO AS NUMEROPEDIDO, 
       ISNULL(AD.NUMEROPEDIDO, O.REFERENCEDOCUMENT) AS NUMEROPEDIDO,
       D.ISCLOSED,
       O.STATUS,
       O.ORDERGROUP,
       O.HOSTPROCESSREQUIRED AS ISCANCELLED
FROM {Scheme}.ORDERS O
LEFT JOIN {Scheme}.AGRUPADO_DETALLE AD ON O.REFERENCEDOCUMENT = AD.NUMEROPEDIDO
LEFT JOIN {Scheme}.DROPID D ON AD.DROPID = D.DROPID
WHERE O.REFERENCEDOCUMENT = '{Order_Id}'
